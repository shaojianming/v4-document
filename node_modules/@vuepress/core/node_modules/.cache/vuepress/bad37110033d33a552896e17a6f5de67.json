{"remainingRequest":"/Users/shaojm/work/www/acquirer-api-docs/node_modules/babel-loader/lib/index.js??ref--3-1!/Users/shaojm/work/www/acquirer-api-docs/utils/signUtil.js","dependencies":[{"path":"/Users/shaojm/work/www/acquirer-api-docs/utils/signUtil.js","mtime":1698895830494},{"path":"/Users/shaojm/work/www/acquirer-api-docs/node_modules/cache-loader/dist/cjs.js","mtime":1698386204375},{"path":"/Users/shaojm/work/www/acquirer-api-docs/node_modules/babel-loader/lib/index.js","mtime":1698386204160}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnB1c2guanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwtc2VhcmNoLXBhcmFtcy5kZWxldGUuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwtc2VhcmNoLXBhcmFtcy5oYXMuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwtc2VhcmNoLXBhcmFtcy5zaXplLmpzIik7CmNvbnN0IHNoYTI1NiA9IHJlcXVpcmUoJ2NyeXB0by1qcy9zaGEyNTYnKTsKY29uc3Qgc2VydmljZSA9IHJlcXVpcmUoIi4vcmVxdWVzdCIpOwpjb25zdCBzaWduVXRpbCA9IHsKICBzaWduOiAocmVxdWVzdERhdGEsIHNhbHQpID0+IHsKICAgIGxldCBzaWduU2NvcGUgPSBbInJlcXVlc3RJZCIsICJhY2NJZCIsICJjbGllbnRJZCIsICJtZXJjaGFudFRyYW5zYWN0aW9uSWQiLCAidHJhbnNhY3Rpb25JZCIsICJhbW91bnQiLCAiY2FyZE51bSIsICJjdXJyZW5jeSIsICJzaWduVHlwZSJdOwogICAgbGV0IG5lZWRTaWduS2V5TWFwID0gW107CiAgICBsZXQgbmVlZFNpZ25NYXAgPSBbXTsKICAgIGZvciAobGV0IHJlcXVlc3REYXRhS2V5IGluIHJlcXVlc3REYXRhKSB7CiAgICAgIGlmIChzaWduU2NvcGUuaW5jbHVkZXMocmVxdWVzdERhdGFLZXkpKSB7CiAgICAgICAgbmVlZFNpZ25LZXlNYXAucHVzaChyZXF1ZXN0RGF0YUtleSk7CiAgICAgIH0KICAgIH0KICAgIG5lZWRTaWduS2V5TWFwID0gbmVlZFNpZ25LZXlNYXAuc29ydCgpOwogICAgbmVlZFNpZ25LZXlNYXAuZm9yRWFjaChrZXkgPT4gewogICAgICBuZWVkU2lnbk1hcFtrZXldID0gcmVxdWVzdERhdGFba2V5XTsKICAgIH0pOwogICAgY29uc29sZS5sb2coImN1cnJlbnQgcmVxdWVzdCBkYXRhOiIsIHJlcXVlc3REYXRhKTsKICAgIGNvbnNvbGUubG9nKCJLZXkgdmFsdWUgcGFpcnMgd2l0aGluIHRoZSBzaWduYXR1cmUgcmFuZ2XvvJoiLCBuZWVkU2lnbk1hcCk7CiAgICBsZXQgT1NpZ25Db250ZW50ID0gbmV3IFVSTFNlYXJjaFBhcmFtcygpOwogICAgbmVlZFNpZ25LZXlNYXAuZm9yRWFjaChmdW5jdGlvbiAoa2V5LCBpZHgsIGFycmF5KSB7CiAgICAgIE9TaWduQ29udGVudC5hcHBlbmQoa2V5LCBuZWVkU2lnbk1hcFtrZXldKTsKICAgIH0pOwogICAgbGV0IHNpZ25Db250ZW50ID0gT1NpZ25Db250ZW50LnRvU3RyaW5nKCk7CiAgICBzaWduQ29udGVudCA9IHNhbHQgKyBzaWduQ29udGVudDsKICAgIGNvbnNvbGUubG9nKCJzaWduQ29udGVudDoiLCBzaWduQ29udGVudCk7CiAgICBsZXQgc2lnbiA9IHNoYTI1NihzaWduQ29udGVudCk7CiAgICAvLyBzaWduID0gYmFzZTY0LnN0cmluZ2lmeShzaWduKTsKICAgIHNpZ24gPSBzaWduLnRvU3RyaW5nKCk7CiAgICBzaWduID0gc2lnbi50b1VwcGVyQ2FzZSgpOwogICAgY29uc29sZS5sb2coInNpZ246Iiwgc2lnbik7CiAgICByZXF1ZXN0RGF0YS5zaWduID0gc2lnbjsKICAgIHJldHVybiBzaWduOwogIH0sCiAgc2lnblY0V2l0aFJlcXVlc3Q6IChhcGlIb3N0LCBwYXltZW50VXJsLCByZXF1ZXN0RGF0YSwgc2FsdCwgc3VjY2VzcywgZXJyb3IpID0+IHsKICAgIHNlcnZpY2UucG9zdChhcGlIb3N0ICsgIi9hcGkvdjQvZGVhbFNpZ25SZXF1ZXN0IiwgewogICAgICBzYWx0OiBzYWx0LAogICAgICBwYXltZW50VXJsOiBwYXltZW50VXJsLAogICAgICByZXF1ZXN0Qm9keTogcmVxdWVzdERhdGEKICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICBpZiAocmVzcG9uc2UuY29kZSAhPT0gMjAwKSB7CiAgICAgICAgZXJyb3IocmVzcG9uc2UpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBzdWNjZXNzKHJlc3BvbnNlLnJlc3VsdCk7CiAgICB9KTsKICB9LAogIGRlZXBDb3B5OiBkYXRhID0+IHsKICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICB9Cn07Cm1vZHVsZS5leHBvcnRzID0gc2lnblV0aWw7"},{"version":3,"names":["sha256","require","service","signUtil","sign","requestData","salt","signScope","needSignKeyMap","needSignMap","requestDataKey","includes","push","sort","forEach","key","console","log","OSignContent","URLSearchParams","idx","array","append","signContent","toString","toUpperCase","signV4WithRequest","apiHost","paymentUrl","success","error","post","requestBody","then","response","code","result","deepCopy","data","JSON","parse","stringify","module","exports"],"sources":["/Users/shaojm/work/www/acquirer-api-docs/utils/signUtil.js"],"sourcesContent":["const sha256 = require('crypto-js/sha256')\nconst service = require(\"./request\");\n\nconst signUtil = {\n    sign: (requestData, salt) => {\n        let signScope = [\"requestId\", \"accId\", \"clientId\", \"merchantTransactionId\", \"transactionId\", \"amount\", \"cardNum\", \"currency\", \"signType\"];\n        let needSignKeyMap = [];\n        let needSignMap = [];\n        for (let requestDataKey in requestData) {\n            if (signScope.includes(requestDataKey)) {\n                needSignKeyMap.push(requestDataKey);\n            }\n        }\n        needSignKeyMap = needSignKeyMap.sort();\n        needSignKeyMap.forEach((key) => {\n            needSignMap[key] = requestData[key];\n        })\n        console.log(\"current request data:\", requestData)\n        console.log(\"Key value pairs within the signature rangeï¼š\", needSignMap);\n        let OSignContent = new URLSearchParams();\n        needSignKeyMap.forEach(function (key, idx, array) {\n            OSignContent.append(key, needSignMap[key]);\n        });\n        let signContent = OSignContent.toString()\n        signContent = salt + signContent;\n        console.log(\"signContent:\", signContent)\n        let sign = sha256(signContent);\n        // sign = base64.stringify(sign);\n        sign = sign.toString();\n        sign = sign.toUpperCase();\n        console.log(\"sign:\", sign)\n        requestData.sign = sign;\n        return sign;\n    },\n    signV4WithRequest:(apiHost,paymentUrl,requestData, salt,success,error) => {\n        service.post(apiHost+\"/api/v4/dealSignRequest\", {\n           salt :salt,\n           paymentUrl: paymentUrl,\n           requestBody:requestData\n       }).then((response) => {\n            if (response.code !== 200){\n                error(response)\n                return;\n            }\n            success(response.result)\n        })\n    },\n    deepCopy: (data) => {\n        return JSON.parse(JSON.stringify(data));\n    }\n\n}\n\nmodule.exports = signUtil"],"mappings":";;;;AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,kBAAkB,CAAC;AAC1C,MAAMC,OAAO,GAAGD,OAAO,CAAC,WAAW,CAAC;AAEpC,MAAME,QAAQ,GAAG;EACbC,IAAI,EAAEA,CAACC,WAAW,EAAEC,IAAI,KAAK;IACzB,IAAIC,SAAS,GAAG,CAAC,WAAW,EAAE,OAAO,EAAE,UAAU,EAAE,uBAAuB,EAAE,eAAe,EAAE,QAAQ,EAAE,SAAS,EAAE,UAAU,EAAE,UAAU,CAAC;IACzI,IAAIC,cAAc,GAAG,EAAE;IACvB,IAAIC,WAAW,GAAG,EAAE;IACpB,KAAK,IAAIC,cAAc,IAAIL,WAAW,EAAE;MACpC,IAAIE,SAAS,CAACI,QAAQ,CAACD,cAAc,CAAC,EAAE;QACpCF,cAAc,CAACI,IAAI,CAACF,cAAc,CAAC;MACvC;IACJ;IACAF,cAAc,GAAGA,cAAc,CAACK,IAAI,CAAC,CAAC;IACtCL,cAAc,CAACM,OAAO,CAAEC,GAAG,IAAK;MAC5BN,WAAW,CAACM,GAAG,CAAC,GAAGV,WAAW,CAACU,GAAG,CAAC;IACvC,CAAC,CAAC;IACFC,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAEZ,WAAW,CAAC;IACjDW,OAAO,CAACC,GAAG,CAAC,6CAA6C,EAAER,WAAW,CAAC;IACvE,IAAIS,YAAY,GAAG,IAAIC,eAAe,CAAC,CAAC;IACxCX,cAAc,CAACM,OAAO,CAAC,UAAUC,GAAG,EAAEK,GAAG,EAAEC,KAAK,EAAE;MAC9CH,YAAY,CAACI,MAAM,CAACP,GAAG,EAAEN,WAAW,CAACM,GAAG,CAAC,CAAC;IAC9C,CAAC,CAAC;IACF,IAAIQ,WAAW,GAAGL,YAAY,CAACM,QAAQ,CAAC,CAAC;IACzCD,WAAW,GAAGjB,IAAI,GAAGiB,WAAW;IAChCP,OAAO,CAACC,GAAG,CAAC,cAAc,EAAEM,WAAW,CAAC;IACxC,IAAInB,IAAI,GAAGJ,MAAM,CAACuB,WAAW,CAAC;IAC9B;IACAnB,IAAI,GAAGA,IAAI,CAACoB,QAAQ,CAAC,CAAC;IACtBpB,IAAI,GAAGA,IAAI,CAACqB,WAAW,CAAC,CAAC;IACzBT,OAAO,CAACC,GAAG,CAAC,OAAO,EAAEb,IAAI,CAAC;IAC1BC,WAAW,CAACD,IAAI,GAAGA,IAAI;IACvB,OAAOA,IAAI;EACf,CAAC;EACDsB,iBAAiB,EAACA,CAACC,OAAO,EAACC,UAAU,EAACvB,WAAW,EAAEC,IAAI,EAACuB,OAAO,EAACC,KAAK,KAAK;IACtE5B,OAAO,CAAC6B,IAAI,CAACJ,OAAO,GAAC,yBAAyB,EAAE;MAC7CrB,IAAI,EAAEA,IAAI;MACVsB,UAAU,EAAEA,UAAU;MACtBI,WAAW,EAAC3B;IAChB,CAAC,CAAC,CAAC4B,IAAI,CAAEC,QAAQ,IAAK;MACjB,IAAIA,QAAQ,CAACC,IAAI,KAAK,GAAG,EAAC;QACtBL,KAAK,CAACI,QAAQ,CAAC;QACf;MACJ;MACAL,OAAO,CAACK,QAAQ,CAACE,MAAM,CAAC;IAC5B,CAAC,CAAC;EACN,CAAC;EACDC,QAAQ,EAAGC,IAAI,IAAK;IAChB,OAAOC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,SAAS,CAACH,IAAI,CAAC,CAAC;EAC3C;AAEJ,CAAC;AAEDI,MAAM,CAACC,OAAO,GAAGxC,QAAQ"}]}